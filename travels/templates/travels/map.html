{% extends 'base.html' %}
{% load static %}

{% block style %}
<link rel="stylesheet" href="{% static 'travels/map_style.css' %}">
{% endblock %}

{% block content %}
<h1>포토스팟 찾기</h1>

<!-- 검색창 -->



<h2>MAP</h2>
{%if user.is_authenticated %}
    <div>
    <form action="" method="post">
        {%csrf_token%}
        <label>좋아요<input id="selected" type="checkbox" name="selected" value="1"></label>
        <label>전체<input id="selected" type="checkbox" name="selected" value="2">
        <button type="submit">확인</button>
    </form>
    </div>
{%endif%}



<div id="map" style="width:1500px;height:700px;"></div>
<div id="lat" style="display:none">
    {% for re in spots %}
        {{ re.latitude}},
    {% endfor %}
</div>

<div id="lng" style="display:none">
    {% for re in spots %}
        {{ re.longitude}},
    {% endfor %}
</div>

<div id="name" style="display:none">
    {% for re in spots %}
        {{ re.title}},
    {% endfor %}
</div>

<div id="hashtag" style="display:none">
    {% for re in spots %}
        {{ re.hashtag}},
    {% endfor %}
</div>

<div id="image" style="display:none">
    {% for re in spots %}
        {{ re.image.url}},
    {% endfor %}
</div>

<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=7017ebc62c378fa5ebb089d1fd591804&libraries=services,clusterer,drawing"></script>
<script>
var mapContainer = document.getElementById('map'), // 지도를 표시할 div  
    mapOption = { 
        center: new kakao.maps.LatLng(33.5013521, 126.453379), // 지도의 중심좌표
        level: 10// 지도의 확대 레벨
    };

var map = new kakao.maps.Map(mapContainer, mapOption); // 지도를 생성합니다
 
// 마커를 표시할 위치와 title 객체 배열입니다 

var list_lat = document.getElementById("lat").innerText.split(',');
var list_lng = document.getElementById("lng").innerText.split(',');
var list_name = document.getElementById("name").innerText.split(',');
var list_image = document.getElementById("image").innerText.split(',');
var list_hashtag = document.getElementById("hashtag").innerText.split(',');

var positions = new Array();

for(var i = 0; i < list_lat.length; i ++){
    var latitude = list_lat[i];
    var longitude = list_lng[i];
    positions.push(new kakao.maps.LatLng(latitude,longitude));
}




// 마커 이미지의 이미지 주소입니다
var imageSrc = "https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/markerStar.png"; 
    
for (var i = 0; i < positions.length; i ++) {
    
    // 마커 이미지의 이미지 크기 입니다
    var imageSize = new kakao.maps.Size(24, 35); 
    
    // 마커 이미지를 생성합니다    
    var markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize); 
    
    // 마커를 생성합니다
    var marker = new kakao.maps.Marker({
        map: map, // 마커를 표시할 지도
        position: positions[i], // 마커를 표시할 위치
        image : markerImage, // 마커 이미지 
    
    });

    var iwContent = "<div style='height:60px; width:300px;'>"+ list_name[i] + "</br>" + list_hashtag[i] + "</div>"+ "<img style='height: 300px; width:300px;' src=" + list_image[i]+ ">"  ;

    var infoWindow = new kakao.maps.InfoWindow({
        content: iwContent 
    });
    (function(marker, infoWindow){
        kakao.maps.event.addListener(marker, 'mouseover', function(){
            console.log(marker);
            infoWindow.open(map, marker);
        })
        kakao.maps.event.addListener(marker, 'mouseout', function(){
            infoWindow.close();
        })
    })(marker, infoWindow)
 
    marker.setMap(map);



}








</script>




{% endblock %}